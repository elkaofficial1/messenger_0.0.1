<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Чат</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Чат: {{ chat.name }}</h1>
    <div id="chat">
        {% for message in messages %}
            <div>
                [<b>{{ message.author }}</b>]: {{ message.text }} <i>{{ message.time }}</i>
            </div>
        {% endfor %}
    </div>
    <input type="text" id="messageInput" placeholder="Введите сообщение..." />
    <button onclick="sendMessage()">Отправить</button>

    <script>
        var chat_id = "{{ chat.chat_id }}"; // Получаем ID чата из шаблона

        function loadMessages() {
            $.get("/load_messages/" + chat_id, function(data) {
                $("#chat").empty(); // Очищаем текущее содержимое
                data.forEach(function(message) {
                    var html = "<div>[<b>" + message.author + "</b>]: " + message.text + " <i>" + message.time + "</i></div>";
                    $("#chat").append(html);
                });
            });
        }

        function sendMessage() {
            var text = $("#messageInput").val(); // Получаем текст сообщения
            $.post("/send_message/" + chat_id, { text: text }, function() {
                $("#messageInput").val(""); // Очищаем поле ввода
                loadMessages(); // Перезагружаем сообщения
            });
        }

        $(document).ready(function() {
            loadMessages(); // Загружаем сообщения при загрузке страницы

            // Обработчик события нажатия клавиши Enter
            $("#messageInput").keypress(function(event) {
                if (event.which === 13) { // Код клавиши Enter
                    sendMessage(); // Отправляем сообщение
                    return false; // Предотвращаем отправку формы
                }
            });

            // Обновляем сообщения каждые 5 секунд
            setInterval(loadMessages, 5000);
        });
    </script>
</body>
</html>
